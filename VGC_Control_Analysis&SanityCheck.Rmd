---
title: "ValueGuidedConstrual"
output: html_document
date: "2024-05-03"
---

# let us check how different nuissance covariates vary across maze sets (non-lat vs lateralized)

# plot these effects and see if there are any interactions between task-relevance and nuissance covariates 

```{r read in mazes stes and plot associations}

library(ggplot2)

maze_meta_data = read.csv('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/experiments/mazes/mazesfinal/Lateralized_mazes_stats.csv')

maze_meta_data= maze_meta_data[-1]
maze_meta_data$lateralized= as.factor(maze_meta_data$lateralized)

# Plot the individuals
jitter_pos=position_jitter(width = .2, height = 0, seed = 1)

ggplot(maze_meta_data, aes(x=lateralized, y=goal_dist, color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("distance to goal") + scale_x_discrete(breaks=c("0","1"),
        labels=c("non-lateralized", "lateralized")) + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) + geom_boxplot(width=0.1, colour= 'black', outliers = FALSE) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_goal_distance.pdf', device = "pdf", width= 5, height =5)


ggplot(maze_meta_data, aes(x=lateralized, y=Moves, color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("optimal solution (moves)") + scale_x_discrete(breaks=c("0","1"),
        labels=c("non-lateralized", "lateralized")) + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) + geom_boxplot(width=0.1, colour= 'black', outliers = FALSE) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_optimal_moves.pdf', device = "pdf", width= 5, height =5)

ggplot(maze_meta_data, aes(x=lateralized, y=start_dist, color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("distance to start") + scale_x_discrete(breaks=c("0","1"),
        labels=c("non-lateralized", "lateralized")) + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) + geom_boxplot(width=0.1, colour= 'black', outliers = FALSE) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_start_distance.pdf', device = "pdf", width= 5, height =5)


ggplot(maze_meta_data, aes(x=lateralized, y=wall_dist, color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("distance to wall") + scale_x_discrete(breaks=c("0","1"),
        labels=c("non-lateralized", "lateralized")) + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) + geom_boxplot(width=0.1, colour= 'black', outliers = FALSE) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_wall_distance.pdf', device = "pdf", width= 5, height =5)


ggplot(maze_meta_data, aes(x=lateralized, y=center_dist, color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("distance to centre") + scale_x_discrete(breaks=c("0","1"),
        labels=c("non-lateralized", "lateralized")) + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) + geom_boxplot(width=0.1, colour= 'black', outliers = FALSE) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_centre_distance.pdf', device = "pdf", width= 5, height =5)

ggplot(maze_meta_data, aes(x=lateralized, y= log10(dVGC), color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("log 10 dynamic VGC") + scale_x_discrete(breaks=c("0","1"),
        labels=c("non-lateralized", "lateralized")) + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) + geom_boxplot(width=0.1, colour= 'black', outliers = FALSE) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_dynamic_VGC.pdf', device = "pdf", width= 5, height =5)

```





```{r test continuous values of lateralization and artifacts}

library(dplyr)

maze_stats= read.csv('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/experiments/mazes/mazesfinal/Lateralized_mazes_stats.csv', na.strings = 'NaN')
maze_stats=maze_stats[order(maze_stats$grid),]

temp=maze_stats %>% group_by(grid, side) %>% summarise(sumdVGC= sum(dVGC), sumsVGC= sum(sVGC))

latmazes= data.frame(grid = unique(temp$grid),
  lat_dVGC =abs((temp$sumdVGC[temp$side=='R'] - temp$sumdVGC[temp$side=='L']) / (temp$sumdVGC[temp$side=='R'] + temp$sumdVGC[temp$side=='L'])),
  lat_sVGC= abs((temp$sumsVGC[temp$side=='R'] - temp$sumsVGC[temp$side=='L']) / (temp$sumsVGC[temp$side=='R'] + temp$sumsVGC[temp$side=='L'])))

latmazesRL=latmazes

maze_stats= maze_stats[!is.na(maze_stats$Quad),]

temp=maze_stats %>% group_by(grid, Quad) %>% summarise(sumdVGC= sum(dVGC), sumsVGC= sum(sVGC))

latmazes= data.frame(grid = unique(temp$grid),
  hlat_dVGC =abs((temp$sumdVGC[temp$Quad=='U'] - temp$sumdVGC[temp$Quad=='L']) / (temp$sumdVGC[temp$Quad=='U'] + temp$sumdVGC[temp$Quad=='L'])),
  hlat_sVGC= abs((temp$sumsVGC[temp$Quad=='U'] - temp$sumsVGC[temp$Quad=='L']) / (temp$sumsVGC[temp$Quad=='U'] + temp$sumsVGC[temp$Quad=='L'])))

dictionary_of_maze=unique(paste(maze_stats$lateralized, as.numeric(substr(maze_stats$grid, 7,8))))

# make sure the two model predictions are related!
cor.test(latmazes$hlat_dVGC, latmazes$hlat_sVGC)

temp=maze_meta_data %>% group_by(grid) %>% summarise(avgsVGC= mean(sVGC), avgdVGC= mean(dVGC), avggoaldist= mean(goal_dist), avgstartdist= mean(start_dist), avgwalldist= mean(wall_dist), avgcenterdist= mean(center_dist))


# does the degree of lateralization systematically relate to nuissance covariates
cor.test(temp$avggoaldist, latmazes$hlat_sVGC, method = 'spearman')
cor.test(temp$avgstartdist, latmazes$hlat_sVGC, method = 'spearman')
cor.test(temp$avgwalldist, latmazes$hlat_sVGC, method = 'spearman')
cor.test(temp$avgcenterdist, latmazes$hlat_sVGC, method = 'spearman')

cor.test(temp$avggoaldist, latmazesRL$lat_sVGC, method = 'spearman')
cor.test(temp$avgstartdist, latmazesRL$lat_sVGC, method = 'spearman')
cor.test(temp$avgwalldist, latmazesRL$lat_sVGC, method = 'spearman')
cor.test(temp$avgcenterdist, latmazesRL$lat_sVGC, method = 'spearman')

temp$lat_sVGC= latmazesRL$lat_sVGC
temp$lat_dVGC= latmazesRL$lat_dVGC
temp$hlat_sVGC= latmazes$hlat_sVGC
temp$hlat_dVGC= latmazes$hlat_dVGC
temp$Lateral= rep(c('lateralized', 'non-lateralized'),12)

# maze sets do not differ in terms of vertical lateralization
RVAideMemoire::perm.t.test(temp$hlat_dVGC[temp$Lateral=='lateralized'],temp$hlat_dVGC[temp$Lateral=='non-lateralized'], nperm=1000)

RVAideMemoire::perm.t.test(temp$hlat_sVGC[temp$Lateral=='lateralized'],temp$hlat_sVGC[temp$Lateral=='non-lateralized'], nperm=1000)

ggplot(temp, aes(lat_sVGC, group= Lateral, color= Lateral, fill=Lateral, alpha=0.5)) +geom_histogram(aes( color= Lateral, fill=Lateral, group= Lateral), alpha= 0.5, bins = 9, position = 'identity') +
  theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') +
  labs(x = "awareness of obstacle", y = "count")  + ggpubr::theme_classic2() +
  ggtitle("") + scale_fill_manual(values=c('#F36A17', '#B9E615')) + scale_color_manual(values=c('#F36A17', '#B9E615')) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/hist_of_lateralization_LR.pdf', device = "pdf", width= 6, height =5)

ggplot(temp, aes(hlat_sVGC, group= Lateral, color= Lateral, fill=Lateral, alpha=0.5)) +geom_histogram(aes( color= Lateral, fill=Lateral, group= Lateral), alpha= 0.5, bins = 9, position = 'identity') +
  theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') +
  labs(x = "awareness of obstacle", y = "count")  + ggpubr::theme_classic2() +
  ggtitle("") + scale_fill_manual(values=c('#B9E615', '#F36A17')) + scale_color_manual(values=c('#B9E615', '#F36A17')) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/hist_of_lateralization_UL.pdf', device = "pdf", width= 6, height =5)


# do nuissance covariates differ across maze sets
maze_meta_data$log10dVGC= maze_meta_data$dVGC

BayesFactor::generalTestBF(log10dVGC ~ goal_dist*lateralized,  data=maze_meta_data, whichModels = "top")
# weak evidence for relationship but no evidence for interaction!!!
# below 1/10 strong in favour of effect

BayesFactor::generalTestBF(log10dVGC ~ start_dist*lateralized,  data=maze_meta_data, whichModels = "top")

BayesFactor::generalTestBF(log10dVGC ~ wall_dist*lateralized,  data=maze_meta_data, whichModels = "top")

BayesFactor::generalTestBF(log10dVGC ~ center_dist*lateralized,  data=maze_meta_data, whichModels = "top")

# all models return ambiguous evidence!!!! 

ggplot(maze_meta_data, aes(x=goal_dist, y= log10(dVGC), color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("log 10 dynamic VGC") + xlab('distance to goal')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) +
  stat_smooth(aes(color=lateralized, fill= lateralized), linetype = 'dashed', method = "glm",formula = y ~ poly(x, 1),fullrange = T) + scale_color_manual(values=c('#B9E615', '#F36A17'))

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_goal_distance_dynamic_VGC.pdf', device = "pdf", width= 5, height =5)

ggplot(maze_meta_data, aes(x=start_dist, y= log10(dVGC), color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("log 10 dynamic VGC") + xlab('distance to start')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) +
  stat_smooth(aes(color=lateralized, fill= lateralized), linetype = 'dashed', method = "glm",formula = y ~ poly(x, 1),fullrange = T) + scale_color_manual(values=c('#B9E615', '#F36A17'))

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_start_distance_dynamic_VGC.pdf', device = "pdf", width= 5, height =5)


ggplot(maze_meta_data, aes(x=wall_dist, y= log10(dVGC), color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("log 10 dynamic VGC") + xlab('distance to walls')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) +
  stat_smooth(aes(color=lateralized, fill= lateralized), linetype = 'dashed', method = "glm",formula = y ~ poly(x, 1),fullrange = T) + scale_color_manual(values=c('#B9E615', '#F36A17'))

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_wall_distance_dynamic_VGC.pdf', device = "pdf", width= 5, height =5)


ggplot(maze_meta_data, aes(x=center_dist, y= log10(dVGC), color=lateralized, fill= lateralized))+  theme_classic() + xlab("") + geom_point(shape=21, color="white", size=5, position = jitter_pos, alpha=0.5)  + ylab("log 10 dynamic VGC") + xlab('distance to centre')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') + scale_fill_manual(values=c('#B9E615', '#F36A17')) +
  stat_smooth(aes(color=lateralized, fill= lateralized), linetype = 'dashed', method = "glm",formula = y ~ poly(x, 1),fullrange = T) + scale_color_manual(values=c('#B9E615', '#F36A17'))

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_centre_distance_dynamic_VGC.pdf', device = "pdf", width= 5, height =5)


```



```{r How similar are mazes to each other: Hamming distance}

json_data <- rjson::fromJSON(file='~/Documents/ValueBasedConstrualTask/value-guided-construal-main/experiments/mazes/mazesfinal/mazes_Lateralized.json')

json_data2 <- rjson::fromJSON(file='~/Documents/ValueBasedConstrualTask/value-guided-construal-main/experiments/mazes/mazesfinal/mazes_Nonlateralized.json')

json_data <-append(json_data, json_data2)
# function that takes in json inputs and converts to matrix for simple math
json2matrix <- function(mazeA){
  m=t(matrix(unlist(strsplit(mazeA, split='')), nrow = 11))
  return(m)
}

# compute hamming distance between mazes to see how similar they are perceptually 
hamming_distance <- function(mazeA, mazeB){
  m=dim(mazeA)[1]
  n=dim(mazeA)[2]
  
  if(dim(mazeA)[1] != dim(mazeB)[1] || dim(mazeA)[2] != dim(mazeB)[2]) {
    stop("inputs not the same size")
  }
  # binarize matrix
  mazeA[mazeA!='.']=1
  mazeB[mazeB!='.']=1
  
  mazeA[mazeA=='.']=0
  mazeB[mazeB=='.']=0
  
  # get diff
  diffmaze= matrix(as.numeric(mazeA), nrow = 11)- matrix(as.numeric(mazeB), nrow = 11)
  hamming_dist= sum(abs(diffmaze))

  return(hamming_dist)
}



# compute hamming distance between mazes to see how similar they are perceptually 
obstacle_distances <- function(mazeA){
  number_obs= length(unique(as.numeric(mazeA)))-1
  max_obs= max(as.numeric(mazeA), na.rm = TRUE)
  min_obs= min(as.numeric(mazeA), na.rm = TRUE)
  mazeA[mazeA=='G']=NaN
  mazeA[mazeA=='S']=NaN
  mazeA[mazeA=='.']=NaN
  mazeA[mazeA=='#']=NaN

  obstacle_distances_output= matrix(, nrow=number_obs*number_obs, 3)
  obstacle_distances_output[,1] = rep(seq(min_obs,max_obs), each=6)
  obstacle_distances_output[,2] = rep(seq(min_obs,max_obs), 6)
  
  output=c()
  for (i in min_obs:max_obs){
    for (j in min_obs:max_obs){
      obs1=which(mazeA== as.character(i))
      obs1x= obs1 %% 11
      obs1x[obs1x==0] =11
      obs1y= ceiling(obs1/11)
      obs2= which(mazeA== as.character(j))
      obs2x= obs2 %% 11
      obs2x[obs2x==0] =11
      obs2y= ceiling(obs2/11)
      
      distance =c()
      for (ob in length(obs1x)){
      distance= c(distance, abs(obs1x[ob]-obs2x) + abs(obs1y[ob]-obs2y))
      }
      for (ob in length(obs2x)){
      distance= c(distance, abs(obs2x[ob]-obs1x) + abs(obs2y[ob]-obs1y))
      }
    
      output= c(output,min(distance))
    }
  }
  obstacle_distances_output[,3]=output
  return(obstacle_distances_output)
}

matrix_mazes=lapply(json_data, json2matrix)

hamming_dist_mazes= matrix(, nrow=length(json_data)*length(json_data), 3)
count=1
for (i in 1:length(json_data)){
  for (j in 1:length(json_data)){
    hamming_dist_mazes[count,1]= i
    hamming_dist_mazes[count,2]= j
    hamming_dist_mazes[count,3]= hamming_distance(matrix_mazes[[i]], matrix_mazes[[j]])
    count=count+1
  }
}

hamming_dist_mazes= as.data.frame(hamming_dist_mazes)
colnames(hamming_dist_mazes)= c('x', 'y', 'hamming_dist')
library(ggplot2)

ggplot(hamming_dist_mazes, aes(x, y, fill= hamming_dist)) + 
  geom_tile() + scale_y_reverse()+  theme_void() + colorspace::scale_fill_continuous_sequential(palette= 'Lajolla', rev= FALSE, limits= c(0, 50)) + geom_hline(aes(yintercept = 12.5), colour = 'white') + geom_vline(aes(xintercept = 12.5), colour = 'white') + 
  theme(legend.key.height = unit(1, "cm"),
        legend.title = element_text(size = 12, angle = 270),
        legend.title.align = 0.5,
        legend.direction = "vertical", legend.text.position = 'right',
        legend.title.position = 'right') + annotate("text", x = 7, y=-0.75, label = "lateralized") + annotate("text", x = 7+12, y=-0.75, label = "non-lateralized") + annotate("text", x = -0.75, y=7+12, label = "non-lateralized", angle = 90) + annotate("text", x = -0.75, y=7, label = "lateralized", angle = 90)

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/results/R_plot_Hamming_distance_between_mazes.pdf', device = "pdf", width= 6, height =5)


```


