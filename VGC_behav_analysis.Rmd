---
title: "VGC_behav_analysis"
output: html_document
date: "2024-05-22"
---


# run terminal command: 

cat ~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/0*.csv >> ~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/allDataConcatnated.csv

```{r read in behav data & plot hist of aware reports}

library(dplyr)
library(ggplot2)
data= read.csv('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/allDataConcatnated.csv')


# plot hist of static VGSC

data$Aware.ReportObs.scaled= plyr::mapvalues(data$Aware.ReportObs, c(1,2,3,4,5,6,7,8,9), c(0,0.125,0.25,0.375,0.5,0.625,0.75,0.875,1))

data$Lateralized.factor= plyr::mapvalues(data$Lateralized, c(0,1), c('non-lateralized', 'lateralized'))

data$binarysVGC= data$sVGC.Obs > 0.5
data$binarysVGC= plyr::mapvalues(data$binarysVGC, c(1,0), c('relevant', 'irrelevant'))

ggplot(data, aes(Aware.ReportObs.scaled, group= binarysVGC, color= binarysVGC, fill=binarysVGC, alpha=0.5)) +
  geom_histogram(aes( color= binarysVGC, fill=binarysVGC, group= binarysVGC), alpha= 0.5, bins = 9, position = 'identity') +
  theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') +
  labs(x = "awareness of obstacle", y = "count")  + ggpubr::theme_classic2() +
  ggtitle("") + scale_fill_manual(values=c('#B9E615', '#F36A17')) + scale_color_manual(values=c('#B9E615', '#F36A17')) 

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/hist_of_awareness.pdf', device = "pdf", width= 6, height =5)


ggplot(data, aes(Aware.ReportObs.scaled, group= binarysVGC, color= binarysVGC, fill=binarysVGC, alpha=0.5)) +
  geom_histogram(aes( color= binarysVGC, fill=binarysVGC, group= binarysVGC), alpha= 0.5, bins = 9, position = 'identity') +
  theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14), legend.position = 'none') +
  labs(x = "awareness of obstacle", y = "count")  + ggpubr::theme_classic2() +
  ggtitle("") + scale_fill_manual(values=c('#B9E615', '#F36A17')) + scale_color_manual(values=c('#B9E615', '#F36A17')) + facet_wrap(~Lateralized.factor)

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/hist_of_awareness_by_maze_type.pdf', device = "pdf", width= 6, height =5)



```


```{r run peliminary model}

library(lme4)

data$sVGC.Obs.zscore= scale(data$sVGC.Obs)[,1]
data$dVGC.Obs.zscore= scale(data$dVGC.Obs)[,1]
data$Lateralized.zscore= scale(data$Lateralized)[,1]

# need to add subject intercept!!
lm0= lmer(Aware.ReportObs.scaled ~  (1 | MazeID), data= data)
lm1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + sVGC.Obs.zscore, data= data)
lm2= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + sVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + sVGC.Obs.zscore * Lateralized.zscore, data= data)
anova(lm0,lm1, lm2, lm3)

sjPlot::tab_model(lm3)
# significant interaction effect between awareness and sVGC, better fits (stronger relationship, when lateralized )

# need to add subject intercept!!
lm0= lmer(Aware.ReportObs.scaled ~  (1 | MazeID), data= data)
lm1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + dVGC.Obs.zscore, data= data)
lm2= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + dVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + dVGC.Obs.zscore * Lateralized.zscore, data= data)
anova(lm0,lm1, lm2, lm3)

sjPlot::tab_model(lm3)
# we observe the same thing for the dynamic construals 

# note to self dVGC data is VERY VERY VERY skewed should be log transformed!!!! 

# need to add subject intercept!!
lm0= lmer(Aware.ReportObs.scaled ~  (1 | MazeID), data= data[data$Lateralized==0,])
lm1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + log(dVGC.Obs), data= data[data$Lateralized==0,])
anova(lm0,lm1)
sjPlot::tab_model(lm1)

ggplot(data, aes(x=sVGC.Obs.zscore, y= Aware.ReportObs.scaled, color=Lateralized.factor, fill= Lateralized.factor))+  theme_classic() + xlab("") +  ylab("awareness reports (scaled)") + xlab('sVGC (z-scored)')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14)) + scale_fill_manual(values=c('#F36A17', '#B9E615')) +
  stat_smooth(aes(color=Lateralized.factor, fill= Lateralized.factor), method = "glm",formula = y ~ poly(x, 1),fullrange = T) + scale_color_manual(values=c('#F36A17', '#B9E615'))

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/interaction_plot_sVGC.pdf', device = "pdf", width= 6, height =5)



ggplot(data, aes(x=dVGC.Obs.zscore, y= Aware.ReportObs.scaled, color=Lateralized.factor, fill= Lateralized.factor))+  theme_classic() + xlab("") +  ylab("awareness reports (scaled)") + xlab('dVGC (z-scored)')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14)) + scale_fill_manual(values=c('#F36A17', '#B9E615')) +
  stat_smooth(aes(color=Lateralized.factor, fill= Lateralized.factor), method = "glm",formula = y ~ poly(x, 1),fullrange = T) + scale_color_manual(values=c('#F36A17', '#B9E615'))

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/interaction_plot_dVGC.pdf', device = "pdf", width= 6, height =5)


```

```{r test for nuissance covariates}


maze_stats= read.csv('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/new_mazes_stats.csv')
maze_stats=rbind(maze_stats,maze_stats)

maze_stats$MazeID= c(rep(unlist(lapply(c(1:12), rep,6)),2), rep(unlist(lapply(c(13:24), rep,6)),2))
maze_stats$Obs.No= as.integer(substr(maze_stats$obstacle, 5, 5))
maze_stats$Obs.No= maze_stats$Obs.No+1 # bc of python index

dictionary_of_maze= paste(maze_stats$lateralized, maze_stats$MazeID, maze_stats$Obs.No)

index_mazes=paste(data$Lateralized, data$MazeID, data$Obs.No)
data$goal_dist=plyr::mapvalues(index_mazes, dictionary_of_maze, maze_stats$goal_dist)
data$start_dist=plyr::mapvalues(index_mazes, dictionary_of_maze, maze_stats$start_dist)
data$wall_dist=plyr::mapvalues(index_mazes, dictionary_of_maze, maze_stats$wall_dist)
data$center_dist=plyr::mapvalues(index_mazes, dictionary_of_maze, maze_stats$center_dist)



data$goal_dist.zscore= scale(as.numeric(data$goal_dist))[,1]
data$start_dist.zscore= scale(as.numeric(data$start_dist))[,1]
data$wall_dist.zscore= scale(as.numeric(data$wall_dist))[,1]
data$center_dist.zscore= scale(as.numeric(data$center_dist))[,1]


# need to add subject intercept!!
lm0= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore, data= data)
lm1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore, data= data)
lm2= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore * Lateralized.zscore, data= data)
anova(lm0,lm1, lm2, lm3)
sjPlot::tab_model(lm3)


lm0= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore, data= data)
sjPlot::tab_model(lm0)


# lesioning of AIC
lm3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore * Lateralized.zscore, data= data)
lm3.1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.2= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore , data= data)
lm3.3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore  + Lateralized.zscore, data= data)
lm3.4= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore  + dVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.5= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore  + center_dist.zscore + dVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.6= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore  + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.7= lmer(Aware.ReportObs.scaled ~  (1 | MazeID)  + start_dist.zscore + wall_dist.zscore + center_dist.zscore + dVGC.Obs.zscore + Lateralized.zscore, data= data)

AIC_lesion=c(AIC(lm3) - AIC(lm3.1),
AIC(lm3.1) - AIC(lm3.2),
AIC(lm3.1) - AIC(lm3.3),
AIC(lm3.1) - AIC(lm3.4),
AIC(lm3.1) - AIC(lm3.5),
AIC(lm3.1) - AIC(lm3.6),
AIC(lm3.1) - AIC(lm3.7))

AICplot= data.frame(AIC= AIC_lesion, lesionedVar= factor(c('dVGC*Lateralized', 'Lateralized', 'dVGC', 'center distance', 'wall distance', 'start distance', 'goal distance'), levels = c('dVGC*Lateralized', 'Lateralized', 'dVGC', 'center distance', 'wall distance', 'start distance', 'goal distance')))

ggplot(AICplot, aes(x=lesionedVar, y=AIC,width=.5 )) + geom_bar(stat = "identity", position=position_dodge(width = 0.5)) + ggpubr::theme_classic2() + scale_color_manual(values='#F36A17') + labs(y="delta AIC", x="lesioned parameter",title="") + theme(text = element_text(size=15), legend.title=element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))



# lesioning of AIC
lm3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + sVGC.Obs.zscore * Lateralized.zscore, data= data)
lm3.1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + sVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.2= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore + sVGC.Obs.zscore , data= data)
lm3.3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore + center_dist.zscore  + Lateralized.zscore, data= data)
lm3.4= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore + wall_dist.zscore  + sVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.5= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore + start_dist.zscore  + center_dist.zscore + sVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.6= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + goal_dist.zscore  + wall_dist.zscore + center_dist.zscore + sVGC.Obs.zscore + Lateralized.zscore, data= data)
lm3.7= lmer(Aware.ReportObs.scaled ~  (1 | MazeID)  + start_dist.zscore + wall_dist.zscore + center_dist.zscore + sVGC.Obs.zscore + Lateralized.zscore, data= data)

AIC_lesion=c(AIC(lm3) - AIC(lm3.1),
AIC(lm3.1) - AIC(lm3.2),
AIC(lm3.1) - AIC(lm3.3),
AIC(lm3.1) - AIC(lm3.4),
AIC(lm3.1) - AIC(lm3.5),
AIC(lm3.1) - AIC(lm3.6),
AIC(lm3.1) - AIC(lm3.7))

AICplot= data.frame(AIC= AIC_lesion, lesionedVar= factor(c('sVGC*Lateralized', 'Lateralized', 'sVGC', 'center distance', 'wall distance', 'start distance', 'goal distance'), levels = c('sVGC*Lateralized', 'Lateralized', 'sVGC', 'center distance', 'wall distance', 'start distance', 'goal distance')))

ggplot(AICplot, aes(x=lesionedVar, y=AIC,width=.5 )) + geom_bar(stat = "identity", position=position_dodge(width = 0.5)) + ggpubr::theme_classic2() + scale_color_manual(values='#F36A17') + labs(y="delta AIC", x="lesioned parameter",title="") + theme(text = element_text(size=15), legend.title=element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

```{r compute lateralized effect continuous}

library(dplyr)
data= read.csv('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/000JC.csv')
data$grid= data$MazeID-1
data$grid[data$grid>=12] = data$grid[data$grid>=12]-12
data$Aware.ReportObs.scaled= plyr::mapvalues(data$Aware.ReportObs, c(1,2,3,4,5,6,7,8,9), c(0,0.125,0.25,0.375,0.5,0.625,0.75,0.875,1))

maze_stats= read.csv('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/new_mazes_stats.csv')
maze_stats=maze_stats[order(maze_stats$grid),]

temp=maze_stats %>% group_by(grid, side) %>% summarise(sumdVGC= sum(dVGC), sumsVGC= sum(sVGC))

latmazes= data.frame(grid = unique(temp$grid),
  lat_dVGC =abs((temp$sumdVGC[temp$side=='R'] - temp$sumdVGC[temp$side=='L']) / (temp$sumdVGC[temp$side=='R'] + temp$sumdVGC[temp$side=='L'])),
  lat_sVGC= abs((temp$sumsVGC[temp$side=='R'] - temp$sumsVGC[temp$side=='L']) / (temp$sumsVGC[temp$side=='R'] + temp$sumsVGC[temp$side=='L'])))

dictionary_of_maze=unique(paste(maze_stats$lateralized, as.numeric(substr(maze_stats$grid, 7,8))))

# make sure the two model predictions are related!
cor.test(latmazes$lat_dVGC, latmazes$lat_sVGC)

data$grid= data$MazeID-1
data$grid[data$grid>=12] = data$grid[data$grid>=12]-12

index_mazes=paste(data$Lateralized, data$grid)


data$lateralized_values_dVGC=as.numeric(plyr::mapvalues(index_mazes, dictionary_of_maze, latmazes$lat_dVGC))
data$lateralized_values_sVGC=as.numeric(plyr::mapvalues(index_mazes, dictionary_of_maze, latmazes$lat_sVGC))


data$sVGC.Obs.zscore= scale(data$sVGC.Obs)[,1]
data$dVGC.Obs.zscore= scale(data$dVGC.Obs)[,1]
data$lat_dVGC_scaled= scale(data$lateralized_values_dVGC)[,1]
data$lat_sVGC_scaled= scale(data$lateralized_values_sVGC)[,1]

# need to add subject intercept!!
lm0= lmer(Aware.ReportObs.scaled ~  (1 | MazeID), data= data)
lm1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + sVGC.Obs.zscore, data= data)
lm2= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + sVGC.Obs.zscore + lat_sVGC_scaled, data= data)
lm3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + sVGC.Obs.zscore * lat_sVGC_scaled, data= data)
anova(lm0,lm1, lm2, lm3)

sjPlot::tab_model(lm3)
# significant lateralization effect!!! 
# this means that beyond the binary categories of lateralization, the relative amount 
# need to add subject intercept!!
lm0= lmer(Aware.ReportObs.scaled ~  (1 | MazeID), data= data)
lm1= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + dVGC.Obs.zscore, data= data)
lm2= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + dVGC.Obs.zscore + lat_dVGC_scaled, data= data)
lm3= lmer(Aware.ReportObs.scaled ~  (1 | MazeID) + dVGC.Obs.zscore * lat_dVGC_scaled, data= data)
anova(lm0,lm1, lm2, lm3)

sjPlot::tab_model(lm3)
# significant lateralization effect!!! 
# this means that beyond the binary categories of lateralization, the relative amount 
data_plot= data

# summarize by maze 
data_plot= data %>% group_by(grid, Lateralized, Obs.No) %>% summarise(mean_awareness= mean(Aware.ReportObs), mean_sVGC= mean(sVGC.Obs), mean_dVGC= mean(dVGC.Obs),lat_sVGC= mean(lateralized_values_sVGC), lat_dVGC= mean(lateralized_values_dVGC))

# remove intercept of each maze 
temp=data_plot %>% group_by(grid, Lateralized) %>% summarise(mean_awareness= mean(mean_awareness), mean_sVGC= mean(mean_sVGC), mean_dVGC= mean(mean_dVGC))

data_plot$mean_awareness= data_plot$mean_awareness-  rep(temp$mean_awareness, each=6)
data_plot$mean_sVGC= data_plot$mean_sVGC-  rep(temp$mean_sVGC, each=6)
data_plot$mean_dVGC= data_plot$mean_dVGC-  rep(temp$mean_dVGC, each=6)

data_plot$lat_sVGC_scaled = factor(round(data_plot$lat_sVGC,2), levels = sort(unique(round(data_plot$lat_sVGC,2))) )
data_plot$lat_dVGC_scaled = factor(round(data_plot$lat_dVGC,2), levels = sort(unique(round(data_plot$lat_dVGC,2))) )


x <- seq(0, 1, length.out = length(unique(data_plot$lat_sVGC_scaled)))
pallete_man= c(scales::seq_gradient_pal(high = '#F36A17', low= '#B9E615')(x))
ggplot(data_plot, aes(x=mean_sVGC, y= mean_awareness, color=lat_sVGC_scaled, fill= lat_sVGC_scaled))+  geom_point() + theme_classic() + xlab("") +  ylab("awareness reports (scaled)") + xlab('sVGC (scaled)')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14)) + geom_smooth(method='lm', se= FALSE, fullrange = T) +  scale_color_manual(values = pallete_man) + scale_fill_manual(values = pallete_man)

ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/interaction_plot_continuous_lateralized_sVGC.pdf', device = "pdf", width= 6, height =5)


x <- seq(0, 1, length.out = length(unique(data_plot$lat_dVGC_scaled)))
pallete_man= c(scales::seq_gradient_pal(high = '#F36A17', low= '#B9E615')(x))
ggplot(data_plot, aes(x=mean_dVGC, y= mean_awareness, color=lat_dVGC_scaled, fill= lat_dVGC_scaled))+  geom_point() + theme_classic() + xlab("") +  ylab("awareness reports (scaled)") + xlab('dVGC (scaled)')  + theme(axis.text.x = element_text(size=14), axis.title.y = element_text(size=14), axis.text.y = element_text(size=14)) + geom_smooth(method='lm', se= FALSE, fullrange = T) +  scale_color_manual(values = pallete_man) + scale_fill_manual(values = pallete_man)


ggsave('~/Documents/ValueBasedConstrualTask/value-guided-construal-main/datapilot/interaction_plot_continuous_lateralized_dVGC.pdf', device = "pdf", width= 6, height =5)


```
